:numbered:
=== Processing High Resolution Topography

The generation of E* R* data is built upon the ability to measure hillslope length and relief as spatially continuous variables across a landscape. This is performed by using the hillslope length driver outlined in the <<Extracting Hillslope Lengths>> chapter.

NOTE: When running the hillslope length driver, ensure that the switch to write the rasters is set to `1` as these rasters are required by the `E_STAR_R_STAR.cpp` driver.

This driver performs the hilltop segmentation and data averaging needed to generate E* R* data at the scale of individual hilltop pixels, averaged at the hillslope scale and at a basin average scale.

=== Input Data

This driver takes the following input data:

[cols="1,1,2", options="header"]
.Input data for the `E_STAR_R_STAR.cpp` driver.
|===
|Input data
|Input type
|Description

|Raw DEM
|A raster named `<prefix>_DEM.flt`.
|The raw DEM to be analysed.

|Hillslope length raster
|A raster named `<prefix>_HFR_LH.flt`.
|A raster of hillslope length measurements generated by `LH_Driver.cpp`.

|Topographic relief raster
|A raster named `<prefix>_Relief.flt`.
|A raster of topographic relief measurements generated by `LH_Driver.cpp`.

|Hilltop curvature raster
|A raster named `<prefix>_CHT.flt`.
|A raster of hilltop curvature measurements generated by `LH_Driver.cpp`.

|Slope raster
|A raster named `<prefix>_Slope.flt`.
|A raster of topographic gradient generated by `LH_Driver.cpp`.

|Minimum Patch Area
|An integer
|The minimum number of pixels required for a hilltop to be used for spatial averaging.

|Minimum Number of Basin Data Points
|An integer
|The minimum number of data points required for each basin average value to be computed.

|Basin Order
|An integer
|http://en.wikipedia.org/wiki/Strahler_number[The Strahler number] of basins to be extracted. Typically
a value of 2 or 3 is used, to ensure a good balance between sampling density and basin area.

|===

=== Compile The Driver

Once you have generated the hillslope length data you must compile the `E_STAR_R_STAR.cpp` driver. This is performed by using the provided makefile, `LH_Driver.make` and the command:

[source,console]
----
$ make -f E_STAR_R_STAR.make
----

Which will create the binary file, `E_STAR_R_STAR.out` to be executed.

=== Run the code

Once the driver has been compiled it can be run using the following arguments:

Path:: The data path where the input data files are stored. The output data will be written here too.
Prefix:: The filename prefix, without an underscore. If the DEM is called `Oregon_DEM.flt`
the prefix would be `Oregon`. This will be used to give the output files a distinct identifier.
Minimum Patch Area:: The minimum number of pixels required for a hilltop to be used for spatial averaging.
Minimum Number of Basin Data Points:: The minimum number of data points required for each basin average value to be computed.
Basin Order:: http://en.wikipedia.org/wiki/Strahler_number[The Strahler number] of basins to be extracted. Typically
a value of 2 or 3 is used, to ensure a good balance between sampling density and basin area.

In our example we must navigate to the directory where the file was compiled and run the code, providing the five input arguments:

[source,console]
----
$ pwd
/home/LSDTT_repositories/ER_Code_Package/Drivers
$ ./E_STAR_R_STAR.out /home/data/ gabilan 50 50 2
----

A more general example of the input arguments would is:

[source,console]
----
$ ./E_STAR_R_STAR.out <path to data files> <filename prefix> <min. patch area> <min. basin pixels> <basin order>
----

Once the code has run, it will produce 5 output files, tagged with the input filename prefix. In the case of our example, these files are:

** gabilan_E_R_Star_Raw_Data.csv
** gabilan_E_R_Star_Patch_Data.csv
** gabilan_E_R_Star_Basin_2_Data.csv
** gabilan_Patches_CC.bil
** gabilan_Patches_CC.hdr

The three `.csv` files are the data files containing the raw, hilltop patch and basin average data which is used by `Plot_ER_Data.py` to generate the E* R* results. The `.bil` and accompanying `.hdr` files contain the hilltop network used for the spatial averaging of the data, with each hilltop coded with a unique ID. This can be used to check the spatial distribution of hilltops across the study site.
